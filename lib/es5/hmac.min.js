"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}function _typeof(e){"@babel/helpers - typeof";return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _classPrivateFieldLooseBase(e,t){if(!Object.prototype.hasOwnProperty.call(e,t))throw new TypeError("attempted to use private field on non-instance");return e}function _classPrivateFieldLooseKey(e){return"__private_"+id++ +"_"+e}var id=0;Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],n=r.length;return function(o){if("object"!==_typeof(o)&&("function"!=typeof o||null===o))throw new TypeError("Object.keys called on non-object");var a,i,s=[];for(a in o)e.call(o,a)&&s.push(a);if(t)for(i=0;i<n;i++)e.call(o,r[i])&&s.push(r[i]);return s}}()),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var r,n;if(null==this)throw new TypeError(" this is null or not defined");var o=Object(this),a=o.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=t),n=0;n<a;){var i;n in o&&(i=o[n],e.call(r,i,n,o)),n++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('"this" is null or not defined');var n=Object(this),o=n.length>>>0;if(0===o)return-1;var a=+t||0;if(Math.abs(a)===1/0&&(a=0),a>=o)return-1;for(r=Math.max(a>=0?a:o-Math.abs(a),0);r<o;){if(r in n&&n[r]===e)return r;r++}return-1});var AcquiaHttpHmac=function(){function e(t){var r=t.realm,n=t.public_key,o=t.secret_key,a=t.version,i=void 0===a?"2.0":a,s=t.default_content_type,c=void 0===s?"application/json":s;if(_classCallCheck(this,e),Object.defineProperty(this,_generateNonce,{value:_generateNonce2}),Object.defineProperty(this,_generateTimestamp,{value:_generateTimestamp2}),!r)throw new Error('The "realm" must not be empty.');if(!n)throw new Error('The "public_key" must not be empty.');if(!o)throw new Error('The "secret_key" must not be empty.');var p=["2.0"];if(p.indexOf(i)<0)throw new Error('The version must be "'.concat(p.join('" or "'),'". Version "').concat(i,'" is not supported.'));var u=CryptoJS.enc.Base64.parse(o);this.config={realm:r,public_key:n,parsed_secret_key:u,version:i,default_content_type:c},this.SUPPORTED_METHODS=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS","CUSTOM"]}return _createClass(e,[{key:"getHeaders",value:function(t){var r=t.method,n=t.path,o=t.signed_headers,a=void 0===o?{}:o,i=t.content_type,s=void 0===i?this.config.default_content_type:i,c=t.body,p=void 0===c?"":c,u=t.nonce,f=t.timestamp;if(this.SUPPORTED_METHODS.indexOf(r)<0)throw new Error("Args are ".concat(r,' TA. The method must be "').concat(this.SUPPORTED_METHODS.join('" or "'),'". "').concat(r,'" is not supported.'));if(!n)throw new Error("The end point path must not be empty.");var h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"&",o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],a=Object.keys(e),i=[],s={},c=[];return a.forEach(function(t){if(e.hasOwnProperty(t)){var r=t.toLowerCase();i.push(r),s[r]=o?encodeURIComponent(e[t]):e[t]}}),i.sort().forEach(function(e){s.hasOwnProperty(e)&&c.push("".concat(e).concat(t).concat(s[e]).concat(r))}),c.join(n)},l=function(e,t){var r=["GET","HEAD"];return 0!==e.length&&r.indexOf(t)<0};u=u?u:_classPrivateFieldLooseBase(this,_generateNonce)[_generateNonce]();var y=e.parseUri(n),d={id:this.config.public_key,nonce:u,realm:this.config.realm,version:this.config.version},m=f||_classPrivateFieldLooseBase(this,_generateTimestamp)[_generateTimestamp](),_=l(p,r)?CryptoJS.SHA256(p).toString(CryptoJS.enc.Base64):"",v=l(p,r)?"\n".concat(s,"\n").concat(_):"",g=y.port?":".concat(y.port):"",b="".concat(y.hostname).concat(g),w=y.search,H=h(a,":","","\n",!1),x=""===H?"":"".concat(H,"\n"),T="".concat(r,"\n").concat(b,"\n").concat(y.pathname||"/","\n").concat(w,"\n").concat(h(d),"\n").concat(x).concat(m).concat(v),O=h(d,'="','"',","),S=encodeURI(Object.keys(a).join("|||||").toLowerCase().split("|||||").sort().join(";")),q=encodeURI(CryptoJS.HmacSHA256(T,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64)),P="acquia-http-hmac ".concat(O,',headers="').concat(S,'",signature="').concat(q,'"'),E={"X-Authorization-Timestamp":m,Authorization:P};return _&&(E["X-Authorization-Content-SHA256"]=_),E}},{key:"sign",value:function(t){var r=t.request,n=t.method,o=t.path,a=t.signed_headers,i=void 0===a?{}:a,s=t.content_type,c=void 0===s?this.config.default_content_type:s,p=t.body,u=void 0===p?"":p;if(!r||!e.isXMLHttpRequest(r)&&!e.isPromiseRequest(r))throw new Error("The request is required, and must be a XMLHttpRequest or promise-based request Object (e.g. jqXHR).");var f=_classPrivateFieldLooseBase(this,_generateNonce)[_generateNonce](),h=_classPrivateFieldLooseBase(this,_generateTimestamp)[_generateTimestamp](),l=this.getHeaders({method:n,path:o,signed_headers:i,content_type:c,body:u,nonce:f,x_authorization_timestamp:h});e.isXMLHttpRequest(r)&&0===r.readyState&&r.open(n,o,!0),r.acquiaHttpHmac={},r.acquiaHttpHmac.timestamp=h,r.acquiaHttpHmac.nonce=f,Object.keys(l).forEach(function(e){return r.setRequestHeader(e,l[e])})}},{key:"hasValidResponse",value:function(e){var t="".concat(e.acquiaHttpHmac.nonce,"\n").concat(e.acquiaHttpHmac.timestamp,"\n").concat(e.responseText),r=CryptoJS.HmacSHA256(t,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64),n=e.getResponseHeader("X-Server-Authorization-HMAC-SHA256");return r===n}}],[{key:"isXMLHttpRequest",value:function(e){return!!(e instanceof XMLHttpRequest||e.onreadystatechange)}},{key:"isPromiseRequest",value:function(e){return e.hasOwnProperty("setRequestHeader")&&e.hasOwnProperty("getResponseHeader")&&e.hasOwnProperty("promise")}},{key:"parseUri",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={key:["source","protocol","host","userInfo","user","password","hostname","port","relative","pathname","directory","file","search","hash"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},n=r.parser[t?"strict":"loose"].exec(e),o={},a=14;a--;)o[r.key[a]]=n[a]||"";return o[r.q.name]={},o[r.key[12]].replace(r.q.parser,function(e,t,n){t&&(o[r.q.name][t]=n)}),o}}]),e}(),_generateTimestamp=_classPrivateFieldLooseKey("generateTimestamp"),_generateNonce=_classPrivateFieldLooseKey("generateNonce"),_generateTimestamp2=function(){return Math.floor(Date.now()/1e3).toString()},_generateNonce2=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:7&r|8).toString(16)})};if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))){var CryptoJS=require("crypto-js"),XMLHttpRequest=XMLHttpRequest||require("xmlhttprequest").XMLHttpRequest;module.exports=exports=AcquiaHttpHmac}else{if("function"==typeof define&&define.amd)throw new Error("Update here to support AMD.");window.AcquiaHttpHmac=AcquiaHttpHmac}