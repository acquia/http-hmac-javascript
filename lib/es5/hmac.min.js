"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var o=t[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,r,o){return r&&e(t.prototype,r),o&&e(t,o),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};Date.now||(Date.now=function(){return(new Date).getTime()}),Object.keys||(Object.keys=function(){var e=Object.prototype.hasOwnProperty,t=!{toString:null}.propertyIsEnumerable("toString"),r=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],o=r.length;return function(n){if("object"!==("undefined"==typeof n?"undefined":_typeof(n))&&("function"!=typeof n||null===n))throw new TypeError("Object.keys called on non-object");var i,a,s=[];for(i in n)e.call(n,i)&&s.push(i);if(t)for(a=0;a<o;a++)e.call(n,r[a])&&s.push(r[a]);return s}}()),Array.prototype.forEach||(Array.prototype.forEach=function(e,t){var r,o;if(null==this)throw new TypeError(" this is null or not defined");var n=Object(this),i=n.length>>>0;if("function"!=typeof e)throw new TypeError(e+" is not a function");for(arguments.length>1&&(r=t),o=0;o<i;){var a;o in n&&(a=n[o],e.call(r,a,o,n)),o++}}),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,t){var r;if(null==this)throw new TypeError('"this" is null or not defined');var o=Object(this),n=o.length>>>0;if(0===n)return-1;var i=+t||0;if(Math.abs(i)===1/0&&(i=0),i>=n)return-1;for(r=Math.max(i>=0?i:n-Math.abs(i),0);r<n;){if(r in o&&o[r]===e)return r;r++}return-1});var AcquiaHttpHmac=function(){function e(t){var r=t.realm,o=t.public_key,n=t.secret_key,i=t.version,a=void 0===i?"2.0":i,s=t.default_content_type,u=void 0===s?"application/json":s;if(_classCallCheck(this,e),!r)throw new Error('The "realm" must not be empty.');if(!o)throw new Error('The "public_key" must not be empty.');if(!n)throw new Error('The "secret_key" must not be empty.');var p=["2.0"];if(p.indexOf(a)<0)throw new Error('The version must be "'+p.join('" or "')+'". Version "'+a+'" is not supported.');var c=CryptoJS.enc.Base64.parse(n);this.config={realm:r,public_key:o,parsed_secret_key:c,version:a,default_content_type:u},this.SUPPORTED_METHODS=["GET","POST","PUT","PATCH","DELETE","HEAD","OPTIONS","CUSTOM"]}return _createClass(e,[{key:"getHeaders",value:function(t){var r=t.request,o=t.method,n=t.path,i=t.signed_headers,a=void 0===i?{}:i,s=t.content_type,u=void 0===s?this.config.default_content_type:s,p=t.body,c=void 0===p?"":p;if(!r||!e.isXMLHttpRequest(r)&&!e.isPromiseRequest(r))throw new Error("The request is required, and must be a XMLHttpRequest or promise-based request Object (e.g. jqXHR).");if(this.SUPPORTED_METHODS.indexOf(o)<0)throw new Error('The method must be "'+this.SUPPORTED_METHODS.join('" or "')+'". "'+o+'" is not supported.');if(!n)throw new Error("The end point path must not be empty.");var f=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"=",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"&",n=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],i=Object.keys(e),a=[],s={},u=[];return i.forEach(function(t){if(e.hasOwnProperty(t)){var r=t.toLowerCase();a.push(r),s[r]=n?encodeURIComponent(e[t]):e[t]}}),a.sort().forEach(function(e){s.hasOwnProperty(e)&&u.push(""+e+t+s[e]+r)}),u.join(o)},h=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var r=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?r:7&r|8).toString(16)})},y=function(e,t){var r=["GET","HEAD"];return 0!==e.length&&r.indexOf(t)<0},l=h(),d=e.parseUri(n),m={id:this.config.public_key,nonce:l,realm:this.config.realm,version:this.config.version},v=Math.floor(Date.now()/1e3).toString(),b=y(c,o)?CryptoJS.SHA256(c).toString(CryptoJS.enc.Base64):"",w=y(c,o)?"\n"+u+"\n"+b:"",x=d.port?":"+d.port:"",H=""+d.hostname+x,g=d.search,q=f(a,":","","\n",!1),S=""===q?"":q+"\n",O=o+"\n"+H+"\n"+(d.pathname||"/")+"\n"+g+"\n"+f(m)+"\n"+S+v+w,E=f(m,'="','"',","),_=encodeURI(Object.keys(a).join("|||||").toLowerCase().split("|||||").sort().join(";")),T=encodeURI(CryptoJS.HmacSHA256(O,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64)),k="acquia-http-hmac "+E+',headers="'+_+'",signature="'+T+'"';e.isXMLHttpRequest(r)&&0===r.readyState&&r.open(o,n,!0);var R={"X-Authorization-Timestamp":v,Authorization:k};return b&&(R["X-Authorization-Content-SHA256"]=b),R}},{key:"sign",value:function(t){var r=t.request,o=(t.method,t.path,t.signed_headers,t.content_type);void 0===o?this.config.default_content_type:o,t.body;if(!r||!e.isXMLHttpRequest(r)&&!e.isPromiseRequest(r))throw new Error("The request is required, and must be a XMLHttpRequest or promise-based request Object (e.g. jqXHR).");var n=this.getHeaders.apply(this,arguments);Object.keys(n).forEach(function(e){return r.setRequestHeader(e,n[e])})}},{key:"hasValidResponse",value:function(e){var t=e.acquiaHttpHmac.nonce+"\n"+e.acquiaHttpHmac.timestamp+"\n"+e.responseText,r=CryptoJS.HmacSHA256(t,this.config.parsed_secret_key).toString(CryptoJS.enc.Base64),o=e.getResponseHeader("X-Server-Authorization-HMAC-SHA256");return r===o}}],[{key:"isXMLHttpRequest",value:function(e){return!!(e instanceof XMLHttpRequest||e.onreadystatechange)}},{key:"isPromiseRequest",value:function(e){return e.hasOwnProperty("setRequestHeader")&&e.hasOwnProperty("getResponseHeader")&&e.hasOwnProperty("promise")}},{key:"parseUri",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r={key:["source","protocol","host","userInfo","user","password","hostname","port","relative","pathname","directory","file","search","hash"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},o=r.parser[t?"strict":"loose"].exec(e),n={},i=14;i--;)n[r.key[i]]=o[i]||"";return n[r.q.name]={},n[r.key[12]].replace(r.q.parser,function(e,t,o){t&&(n[r.q.name][t]=o)}),n}}]),e}();if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))){var CryptoJS=require("crypto-js"),XMLHttpRequest=XMLHttpRequest||require("xmlhttprequest").XMLHttpRequest;module.exports=exports=AcquiaHttpHmac}else{if("function"==typeof define&&define.amd)throw new Error("Update here to support AMD.");window.AcquiaHttpHmac=AcquiaHttpHmac}