"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CryptoJS=require("crypto-js");exports.sign=function(e,t,o){var r="2.0",n=e.realm,a=e.host,i=e.method,s=e.path,p=e.signed_headers,y=e.content_type,c=e.body,u=(e.port,e.query_string),f=["GET","POST","PUT","DELETE","HEAD","OPTIONS","CUSTOM"];if(f.indexOf(i)<0)throw new Error('The method must be "'+f.join('" or "')+'". "'+i+'" is not supported.');if(!s)throw new Error("path must not be empty.");if(!t)throw new Error("public_key must not be empty.");if(!o)throw new Error("secret_key must not be empty.");var d="object"===("undefined"==typeof e?"undefined":_typeof(e))&&!Array.isArray(e)&&null!==e;if(!d)throw new Error("req object is invalid.");var x=generateNonce(),m={id:t,nonce:x,realm:n,version:"2.0"},h=Math.floor(Date.now()/1e3).toString(),S=willSendBody(c,i)?CryptoJS.SHA256(c instanceof Buffer?CryptoJS.enc.Base64.parse(c.toString("base64")):c).toString(CryptoJS.enc.Base64):"",l=willSendBody(c,i)?"\n"+y+"\n"+S:"",w=parametersToString(p,":","","\n",!1),b=""===w?"":w+"\n",g=i+"\n"+a+"\n"+s+"\n"+u+"\n"+parametersToString(m)+"\n"+b+h+l,E=parametersToString(m,'="','"',","),v=encodeURI(Object.keys(p).join("|||||").toLowerCase().split("|||||").sort().join(";")),T=encodeURI(CryptoJS.HmacSHA256(g,o).toString(CryptoJS.enc.Base64)),H="acquia-http-hmac "+E;v&&(H+=",headers="+v),H+=',signature="'+T+'"',H+=',version="'+r+'"',e.acquiaHttpHmac={},e.acquiaHttpHmac.timestamp=h,e.acquiaHttpHmac.nonce=x,e.headers["X-Authorization-Timestamp"]=h,e.headers.Authorization=H,S&&(e.headers["X-Authorization-Content-SHA256"]=S)};var parametersToString=function(e,t,o,r,n){"undefined"==typeof t&&(t="="),"undefined"==typeof o&&(o=""),"undefined"==typeof r&&(r="&"),"undefined"==typeof n&&(n=!0);var a=Object.keys(e),i=[],s={},p=[];return a.forEach(function(t){if(e.hasOwnProperty(t)){var o=t.toLowerCase();i.push(o),s[o]=n?encodeURIComponent(e[t]):e[t]}}),i.sort().forEach(function(e){s.hasOwnProperty(e)&&p.push(""+e+t+s[e]+o)}),p.join(r)},generateNonce=function(){var e=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var o=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?o:7&o|8).toString(16)})},willSendBody=function(e,t){var o=["GET","HEAD"];return 0!==e.length&&o.indexOf(t)<0};